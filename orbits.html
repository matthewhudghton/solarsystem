
<!DOCTYPE html>
<html>
<head>
    <title>Golarion Solar System Simulation</title>
    <style>
        canvas {
            border: 1px solid black;
        }
        #timeDisplay, #controls {
            position: fixed;
            font-family: Arial, sans-serif;
            font-size: 14px;
            color: white;
        }
        #timeDisplay {
            top: 10px;
            left: 10px;
        }
            #timeDisplay { 
    position: fixed;
            top: 10px;
            left: 10px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            color: white;}
            #controls {
            top: 10px;
            right: 10px;
        }
        #controls input[type="text"], #controls button {
            margin: 5px;
        }
    </style>
</head>
<body> <div id="timeDisplay"></div>
    <canvas id="orbitCanvas" width="5000" height="5000"></canvas>
    <div id="controls">
        <input type="text" id="dateInput" placeholder="Enter Timestamp">
        <button id="goToDateButton">Go to Date</button>
        <input type="text" id="xCoordInput" placeholder="X Coordinate">
        <input type="text" id="yCoordInput" placeholder="Y Coordinate">
        <button id="goToCoordinatesButton">Go to Coordinates</button>
        <button id="playPauseButton">Play / Pause</button>
    </div>
    <script>

function parseString(str) {
    let odd = '';
    let even = '';
  
    // Separate odd and even characters
    for (let i = 0 ; i < str.length ; i++) {
        if ((str.length-1-i) % 2 === 0) {
            odd += str[i];
        } else {
            even += str[i];
        }
    }
  
    // Convert odd to base 31 integer
    const oddInt = odd.length == 0 ? 0 : parseInt(odd, 31);
  console.log("odd", odd)
  
  console.log("even", even)
    // Convert even to negative base 31 integer
    const evenInt = even.length == 0 ? 0 : -parseInt(even, 31);
  
    // Add odd and even integers
    const result = oddInt + evenInt;
  
    return result;
}
window.addEventListener('load', function() {

        const canvas = document.getElementById('orbitCanvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        const centerX = width / 2;
        const centerY = height / 2;
        const planets = 
[
    { name: "Aballon", size: 10, color: "blue", fontSize: 12, orbit: { a: 100, b: 90, period: 88, initialPhase: 1.2345, moons: [
        { name: "", size: 3, color: "gray", fontSize: 8, orbit: { a: 15, b: 13, period: 15, initialPhase: 2.3456 } }
    ]}},
    { name: "Castrovel", size: 12, color: "green", fontSize: 12, orbit: { a: 150, b: 130, period: 225, initialPhase: 3.4567, moons: [
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 20, b: 18, period: 20, initialPhase: 4.5678 } },
        { name: "", size: 3, color: "gray", fontSize: 8, orbit: { a: 25, b: 22, period: 30, initialPhase: 5.6789 } }
    ]}},
    { name: "Golarion", size: 14, color: "cyan", fontSize: 14, orbit: { a: 200, b: 180, period: 365, initialPhase: 6.7890, moons: [
        { name: "Moon", size: 4, color: "gray", fontSize: 8, orbit: { a: 20, b: 20, period: 27, initialPhase: 0.1234 } },
    ]}},
    { name: "Sky Ring 1", size: 14, color: "gray", fontSize: 14, orbit: { a: 70, b: 50, period: 365, initialPhase: 6.7890, moons: []}},
    { name: "Sky Ring 2", size: 14, color: "gray", fontSize: 14, orbit: { a: 160, b: 70, period: 565, initialPhase: 6.7890, moons: []}},
    { name: "Sky Ring 3", size: 14, color: "gray", fontSize: 14, orbit: { a: 50, b: 150, period: 765, initialPhase: 6.7890, moons: []}},
    { name: "Akiton", size: 10, color: "red", fontSize: 12, orbit: { a: 250, b: 240, period: 687, initialPhase: 1.2345, moons: [
        { name: "", size: 5, color: "gray", fontSize: 8, orbit: { a: 30, b: 28, period: 25, initialPhase: 2.3456 } }
    ]}},
    { name: "Verces", size: 8, color: "purple", fontSize: 12, orbit: { a: 300, b: 270, period: 760, initialPhase: 3.4567, moons: [
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 25, b: 23, period: 30, initialPhase: 4.5678 } },
        { name: "", size: 3, color: "gray", fontSize: 8, orbit: { a: 35, b: 30, period: 40, initialPhase: 5.6789 } }
    ]}},
    { name: "The Diaspora", size: 2, color: "gray", fontSize: 12, orbit: { a: 320, b: 270, period: 760, initialPhase: 1.4567, moons: [
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 25, b: 23, period: 130, initialPhase: 1.5678 } },
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 15, b: 23, period: 130, initialPhase: 4.5678 } },
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 25, b: 33, period: 170, initialPhase: 2.5678 } },
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 25, b: 13, period: 130, initialPhase: 4.5678 } },
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 25, b: 26, period: 110, initialPhase: 8.5678 } },
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 15, b: 13, period: 230, initialPhase: 4.5678 } },
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 25, b: 53, period: 335, initialPhase: 9.5678 } },
        { name: "", size: 3, color: "gray", fontSize: 8, orbit: { a: 25, b: 30, period: 221, initialPhase: 1.6789 } }
    ]}},
    { name: "Eox", size: 7, color: "gray", fontSize: 12, orbit: { a: 350, b: 320, period: 850, initialPhase: 6.7890, moons: [
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 28, b: 26, period: 35, initialPhase: 0.1234 } },
        { name: "", size: 2, color: "gray", fontSize: 8, orbit: { a: 40, b: 38, period: 50, initialPhase: 1.2345 } },
        { name: "", size: 3, color: "gray", fontSize: 8, orbit: { a: 45, b: 43, period: 55, initialPhase: 2.3456 } }
    ]}},
    { name: "Triaxus", size: 9, color: "orange", fontSize: 12, orbit: { a: 400, b: 350, period: 1000, initialPhase: 3.4567, moons: [
        { name: "", size: 5, color: "gray", fontSize: 8, orbit: { a: 40, b: 37, period: 60, initialPhase: 4.5678 } }
    ]}},
    { name: "Liavara", size: 30, color: "orange", fontSize: 12, orbit: { a: 450, b: 400, period: 1100, initialPhase: 5.6789, moons: [
        { name: "", size: 5, color: "gray", fontSize: 8, orbit: { a: 35, b: 30, period: 55, initialPhase: 6.7890 } },
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 45, b: 40, period: 65, initialPhase: 0.1234 } }
    ]}},
    { name: "Bretheda", size: 37, color: "blue", fontSize: 12, orbit: { a: 500, b: 450, period: 1200, initialPhase: 1.2345, moons: [
        { name: "", size: 6, color: "gray", fontSize: 8, orbit: { a: 50, b: 48, period: 70, initialPhase: 2.3456 } },
        { name: "", size: 5, color: "gray", fontSize: 8, orbit: { a: 60, b: 55, period: 80, initialPhase: 3.4567 } },
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 70, b: 65, period: 90, initialPhase: 4.5678 } }
    ]}},
    { name: "Apostae", size: 8, color: "brown", fontSize: 12, orbit: { a: 350, b: 500, period: 1300, initialPhase: 5.6789, moons: [
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 30, b: 27, period: 40, initialPhase: 6.7890 } },
        { name: "", size: 3, color: "gray", fontSize: 8, orbit: { a: 35, b: 30, period: 50, initialPhase: 0.1234 } },
        { name: "", size: 2, color: "gray", fontSize: 8, orbit: { a: 45, b: 40, period: 60, initialPhase: 1.2345 } },
        { name: "", size: 1, color: "gray", fontSize: 8, orbit: { a: 55, b: 50, period: 70, initialPhase: 2.3456 } },
        { name: "", size: 1, color: "gray", fontSize: 8, orbit: { a: 60, b: 55, period: 75, initialPhase: 3.4567 } }
    ]}},
    { name: "Aucturn", size: 14, color: "purple", fontSize: 12, orbit: { a: 600, b: 350, period: 1400, initialPhase: 4.5678, moons: [
        { name: "", size: 4, color: "gray", fontSize: 8, orbit: { a: 30, b: 28, period: 45, initialPhase: 5.6789 } }
    ]}}
]
;
        let timeInterval;
        let isPlaying = false;
        let currentTime = 1713299099;
      let targetX = 0;
      let targetY = 0;

        function drawOrbit(a, b, initialPhase) {
            ctx.beginPath();
            ctx.lineWidth = 1;
            for (let angle = 0; angle <= 2 * Math.PI; angle += 0.01) {
                const x = a * Math.cos(angle + initialPhase);
                const y = b * Math.sin(angle + initialPhase);
                ctx.lineTo(centerX + x, centerY + y);
            }
            ctx.strokeStyle = 'lightgray';
            ctx.stroke();
        }

        function drawPlanet(x, y, size, color, label, fontSize, isRing) {
          if(isRing){
const outerRadius = size;
const ringThickness = 3;
ctx.beginPath();
    ctx.arc(centerX + x, centerY + y, outerRadius, 0, 2 * Math.PI);
    ctx.arc(centerX + x, centerY + y, outerRadius - ringThickness, 0, 2 * Math.PI, true);
    ctx.fillStyle = color;
    ctx.fill();
          } else {
            
            ctx.beginPath();
            ctx.arc(centerX + x, centerY + y, size, 0, 2 * Math.PI);
            ctx.fillStyle = color;

            ctx.fill();}
            ctx.font = `${fontSize}px Arial`;
            ctx.fillStyle = 'white';
            ctx.fillText(label, centerX + x + size, centerY + y + size);
        }

        function getPlanetPosition(a, b, period, time, initialPhase) {
            const angle = (2 * Math.PI * time / period) + initialPhase;
            const x = a * Math.cos(angle);
            const y = b * Math.sin(angle);
            return { x, y };
        }

        function drawScene(time) {
            ctx.fillStyle = "rgb(0,0,0)"
            ctx.fillRect(0,0,width, height);
            // ctx.clearRect(0, 0, width, height);

            // Draw the sun at the center
            ctx.beginPath();
            ctx.arc(centerX, centerY, 100, 0, 2 * Math.PI);
            ctx.fillStyle = 'yellow';
            ctx.fill();

            for (const planet of planets) {
                let { a, b, period, initialPhase, moons } = planet.orbit;
                const orbit_scale = 3;
                 a = a * orbit_scale;
                 b = b * orbit_scale;
                // Draw the orbit
                drawOrbit(a, b, initialPhase);

                // Calculate and draw planet's position
                const { x: planetX, y: planetY } = getPlanetPosition(a, b, period, time, initialPhase);
                drawPlanet(planetX, planetY, planet.size, planet.color, planet.name, planet.fontSize, planet.name.indexOf("Ring") != -1);

                // Draw moons if any
                if (moons) {
                    for (const moon of moons) {
                        const { a: moonA, b: moonB, period: moonPeriod, initialPhase: moonInitialPhase } = moon.orbit;
                        const { x: moonX, y: moonY } = getPlanetPosition(moonA, moonB, moonPeriod, time, moonInitialPhase);

                        // Calculate moon's position relative to the planet
                        const absoluteMoonX = planetX + moonX;
                        const absoluteMoonY = planetY + moonY;
                        drawPlanet(absoluteMoonX, absoluteMoonY, moon.size, moon.color, moon.name, moon.fontSize);
                    }
                }
            }
        }

        function animate() {
            drawScene(currentTime);
drawLineToCoordinates(targetX, targetY);
            updateTimeDisplay(currentTime);
            if (isPlaying) {  
          currentTime += 1;
          }
            requestAnimationFrame(animate);
        }

        animate();
        function updateTimeDisplay(time) {
            const unixTimestamp = time;
            const utcDatetime = new Date(unixTimestamp* 1000 ).toUTCString();
            document.getElementById('timeDisplay').innerHTML = `Timestamp: ${unixTimestamp}<br>UTC Datetime: ${utcDatetime}`;
        }
        function isPlanetAtCoordinates(planets, time, x, y) {
            for (const planet of planets) {
                const { a, b, period, initialPhase, moons } = planet.orbit;
                
                // Calculate the position of the planet in its orbit
                const { x: planetX, y: planetY } = getPlanetPosition(a, b, period, time, initialPhase);
                
                if (Math.abs(planetX - x) < 1e-6 && Math.abs(planetY - y) < 1e-6) {
                    return planet.name;
                }

                // Check moons if any
                if (moons) {
                    for (const moon of moons) {
                        const { a: moonA, b: moonB, period: moonPeriod, initialPhase: moonInitialPhase } = moon.orbit;
                        const { x: moonX, y: moonY } = getPlanetPosition(moonA, moonB, moonPeriod, time, moonInitialPhase);

                        // Calculate moon's position relative to the planet
                        const absoluteMoonX = planetX + moonX;
                        const absoluteMoonY = planetY + moonY;

                        if (Math.abs(absoluteMoonX - x) < 1e-6 && Math.abs(absoluteMoonY - y) < 1e-6) {
                            return `${moon.name} of ${planet.name}`;
                        }
                    }
                }
            }
            return null;
        }

        document.getElementById('goToDateButton').addEventListener('click', function() {
            const inputDate = parseInt(document.getElementById('dateInput').value);
            if (!isNaN(inputDate)) {
                currentTime = inputDate;
            }
        });

        document.getElementById('goToCoordinatesButton').addEventListener('click', function() {
            const x = parseInt(document.getElementById('xCoordInput').value);
            const y = parseInt(document.getElementById('yCoordInput').value);
            if (!isNaN(x) && !isNaN(y)) {
                // Draw lines and set time
            console.log("Drawing ", x , y);
  
      targetX = x;
      targetY = y;
    }
        });
                      function drawLineToCoordinates(x, y) {
    if(x == 0 && y == 0){
return;
    }
                const golarion = planets.find(planet => planet.name === 'Golarion');
                if (golarion) {
                    const { a, b, period, initialPhase } = golarion.orbit;
                    const { x: golarionX, y: golarionY } = getPlanetPosition(a*3, b*3, period, currentTime, initialPhase);
                    
                    ctx.beginPath();
                    ctx.moveTo(centerX + golarionX, centerY + golarionY);
                    ctx.lineTo(x+centerX, y+centerY);
                    ctx.lineWidth = 5;
                    ctx.strokeStyle = 'purple';
                    ctx.stroke();
                }
  }
        
            canvas.addEventListener('click', function(event) {
                const rect = canvas.getBoundingClientRect();
                const mouseX = event.clientX - rect.left - centerX;
                const mouseY = event.clientY - rect.top - centerY;
                console.log('Relative X:', mouseX, 'Relative Y:', mouseY);
            });



        document.getElementById('playPauseButton').addEventListener('click', function() {
            isPlaying = !isPlaying;
        });

        // Example usage:
        const checkTime = 365; // seconds
        const checkX = 200;
        const checkY = 0;
        const planetName = isPlanetAtCoordinates(planets, checkTime, checkX, checkY);
        if (planetName) {
            console.log(`At time ${checkTime}s, ${planetName} is at (${checkX},${checkY})`);
        } else {
            console.log(`No planet is at (${checkX},${checkY}) at time ${checkTime}s`);
        }

  });
    </script>
</body>
</html>

